<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steve Math - 3D Flip Edition</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --indigo-600: #4f46e5; --indigo-700: #4338ca; --purple-500: #8b5cf6;
            --gray-500: #6b7280; --gray-800: #1f2937;
            --green-500: #22c55e; --green-600: #16a34a; --red-500: #ef4444; --red-600: #dc2626;
        }

        /* 1. SCENE SETUP */
        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background-color: #eef2f7;
            background-image: radial-gradient(circle at 50% 0%, #ffffff, #eef2f7 80%);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem 1rem;
            box-sizing: border-box;
        }
        .scene {
            width: 100%;
            max-width: 28rem;
            perspective: 1500px;
        }

        /* 2. THE FLIPPABLE CARD */
        .card {
            display: grid;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.76, 0, 0.24, 1);
            transform: rotateX(var(--rotateX, 0deg)) rotateY(var(--rotateY, 0deg));
        }
        .card.is-flipped {
            transform: rotateX(var(--rotateX, 0deg)) rotateY(calc(var(--rotateY, 0deg) + 180deg));
        }
        .card-face {
            grid-area: 1 / 1;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            padding: 2rem;
            box-sizing: border-box;
            border-radius: 1.5rem;
            background-color: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 50px -10px rgba(0, 0, 0, 0.15);
            transition: opacity 0.3s ease-in-out;
        }
        .card-face.is-loading > *:not(#spinner-container) { opacity: 0; }
        .card-face-back {
            transform: rotateY(180deg);
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        /* 3. FRONT FACE STYLES (WITH LOGO) */
        .header { text-align: center; margin-bottom: 1.5rem; }
        
        /* --- LOGO STYLES ADDED HERE --- */
        .title-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem; /* Space between logo and title */
        }
        .logo {
            width: 40px;
            height: 40px;
        }
        /* --- END OF LOGO STYLES --- */

        .header h1 { font-size: 2rem; font-weight: 700; margin: 0; }
        .header p { margin-top: 0.25rem; color: var(--gray-500); }
        .number-display { flex-shrink: 0; display: flex; align-items: center; justify-content: center; height: 8rem; background-image: linear-gradient(135deg, var(--purple-500), var(--indigo-600)); color: white; border-radius: 1rem; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); }
        #target-number { font-size: 4.5rem; font-weight: 900; letter-spacing: -0.05em; }
        .loading-spinner { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 3rem; height: 3rem; border: 4px solid rgba(0, 0, 0, 0.1); border-top-color: var(--indigo-600); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .choices-container { display: grid; gap: 0.75rem; margin-top: 1.5rem; }
        .choice-button { width: 100%; padding: 1rem; border: 1px solid #e0e7ff; border-radius: 0.75rem; font-size: 1.125rem; font-weight: 500; background-color: rgba(255, 255, 255, 0.5); cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .choice-button:hover { transform: translateY(-3px); box-shadow: 0 8px 15px -5px rgba(0,0,0,0.05); }

        /* 4. BACK FACE STYLES */
        #result-icon i { width: 60px; height: 60px; }
        #result-icon.correct { color: var(--green-500); }
        #result-icon.incorrect { color: var(--red-500); }
        #result-text { font-size: 2.5rem; font-weight: 700; margin-top: 1rem; }
        #result-text.correct { color: var(--green-600); }
        #result-text.incorrect { color: var(--red-600); }
        #result-explanation { font-size: 1.1rem; color: var(--gray-500); margin-top: 0.5rem; max-width: 85%; }
        
        /* 5. ACTION BUTTON */
        .action-button {
            margin-top: 1.5rem;
            flex-shrink: 0;
            display: flex; align-items: center; justify-content: center; gap: 0.5rem;
            width: 100%; background-image: linear-gradient(135deg, var(--indigo-600), var(--indigo-700)); color: white;
            font-weight: 600; padding: 1rem; border: none; border-radius: 0.75rem; cursor: pointer;
            transition: all 0.2s ease-in-out; box-shadow: 0 4px 15px -5px var(--indigo-600);
        }
        .action-button:hover { transform: translateY(-2px); box-shadow: 0 8px 20px -6px var(--indigo-600); }
        #skip-btn { margin-top: auto; }
        
        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 100; }
    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div class="scene">
        <div class="card" id="card">
            <!-- FRONT OF THE CARD -->
            <div class="card-face card-face-front" id="card-front">
                <!-- --- HTML FOR LOGO ADDED HERE --- -->
                <div class="header">
                    <div class="title-container">
                        <img src="logo.png" alt="Steve Math Logo" class="logo">
                        <h1>Steve Math</h1>
                    </div>
                    <p>Which of these is a factor of the number below?</p>
                </div>
                <!-- --- END OF HTML CHANGE --- -->
                <div id="number-display" class="number-display"></div>
                <div id="choices-container" class="choices-container"></div>
                <div id="spinner-container"></div>
                <button id="skip-btn" class="action-button">
                    <i data-lucide="skip-forward" width="20"></i>
                    <span>Skip Question</span>
                </button>
            </div>
            <!-- BACK OF THE CARD -->
            <div class="card-face card-face-back">
                <div id="result-icon"></div>
                <h2 id="result-text"></h2>
                <p id="result-explanation"></p>
                <button id="next-btn" class="action-button">
                    <i data-lucide="arrow-right" width="20"></i>
                    <span>Next Question</span>
                </button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script>
        // No changes needed to the JavaScript.
        const scene = document.querySelector('.scene');
        const card = document.getElementById('card');
        const cardFront = document.getElementById('card-front');
        const numberDisplay = document.getElementById('number-display');
        const choicesContainer = document.getElementById('choices-container');
        const spinnerContainer = document.getElementById('spinner-container');
        const skipBtn = document.getElementById('skip-btn');
        const nextBtn = document.getElementById('next-btn');
        const resultIcon = document.getElementById('result-icon');
        const resultText = document.getElementById('result-text');
        const resultExplanation = document.getElementById('result-explanation');

        let state = { quizData: null, selectedAnswer: null };

        function generateQuizData() {
            let targetNumber, factors;
            do {
                targetNumber = Math.floor(Math.random() * (99 - 10 + 1)) + 10;
                const allFactors = Array.from({ length: targetNumber }, (_, i) => i + 1).filter(n => targetNumber % n === 0);
                factors = allFactors.filter(n => n > 1 && n < targetNumber);
            } while (factors.length === 0);
            const correctAnswer = factors[Math.floor(Math.random() * factors.length)];
            const distractors = [];
            while (distractors.length < 4) {
                const p = Math.floor(Math.random() * (targetNumber - 2)) + 2;
                if (targetNumber % p !== 0 && !distractors.includes(p) && p !== correctAnswer) distractors.push(p);
            }
            return { targetNumber, choices: [correctAnswer, ...distractors].sort(() => Math.random() - 0.5), correctAnswer };
        }

        function renderFront() {
            numberDisplay.innerHTML = `<span id="target-number">${state.quizData.targetNumber}</span>`;
            choicesContainer.innerHTML = '';
            state.quizData.choices.forEach(choice => {
                const button = document.createElement('button');
                button.className = 'choice-button';
                button.textContent = choice;
                button.onclick = () => handleChoiceSelection(choice);
                choicesContainer.appendChild(button);
            });
            lucide.createIcons();
        }

        function showLoadingState() {
            cardFront.classList.add('is-loading');
            spinnerContainer.innerHTML = `<div class="loading-spinner"></div>`;
        }
        
        function hideLoadingState() {
            cardFront.classList.remove('is-loading');
            spinnerContainer.innerHTML = '';
        }

        function renderBack(isCorrect) {
            if (isCorrect) {
                resultIcon.innerHTML = `<i data-lucide="party-popper"></i>`;
                resultIcon.className = 'correct';
                resultText.textContent = 'Correct!';
                resultText.className = 'correct';
                resultExplanation.textContent = `Great job! ${state.quizData.correctAnswer} is a factor of ${state.quizData.targetNumber}.`;
            } else {
                resultIcon.innerHTML = `<i data-lucide="brain-circuit"></i>`;
                resultIcon.className = 'incorrect';
                resultText.textContent = 'Not quite.';
                resultText.className = 'incorrect';
                resultExplanation.innerHTML = `The correct answer was <b>${state.quizData.correctAnswer}</b>, because <b>${state.quizData.targetNumber}</b> is not divisible by <b>${state.selectedAnswer}</b>.`;
            }
            lucide.createIcons();
        }

        function handleChoiceSelection(choice) {
            if (card.classList.contains('is-flipped')) return;
            state.selectedAnswer = choice;
            const isCorrect = choice === state.quizData.correctAnswer;
            
            renderBack(isCorrect);
            card.classList.add('is-flipped');
            
            if (isCorrect) {
                confetti({ particleCount: 150, spread: 90, origin: { y: 0.6 } });
            }
        }

        function fetchNewQuiz() {
            card.classList.remove('is-flipped');
            setTimeout(() => {
                showLoadingState();
                setTimeout(() => {
                    state = { quizData: generateQuizData(), selectedAnswer: null };
                    renderFront();
                    hideLoadingState();
                }, 500);
            }, 300);
        }

        document.addEventListener('DOMContentLoaded', () => {
            showLoadingState();
            setTimeout(() => {
                state.quizData = generateQuizData();
                renderFront();
                hideLoadingState();
            }, 500);

            skipBtn.addEventListener('click', fetchNewQuiz);
            nextBtn.addEventListener('click', fetchNewQuiz);
            
            scene.addEventListener('mousemove', (e) => {
                if (card.classList.contains('is-flipped')) return;
                const { width, height, left, top } = scene.getBoundingClientRect();
                const x = e.clientX - left;
                const y = e.clientY - top;
                const rotateX = -1 * ((y / height) * 2 - 1) * 8;
                const rotateY = ((x / width) * 2 - 1) * 8;
                card.style.setProperty('--rotateX', `${rotateX}deg`);
                card.style.setProperty('--rotateY', `${rotateY}deg`);
            });

            scene.addEventListener('mouseleave', () => {
                card.style.setProperty('--rotateX', `0deg`);
                card.style.setProperty('--rotateY', `0deg`);
            });
        });
    </script>
</body>
</html>